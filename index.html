<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Oxted Ladies Joggers</title>

	<meta name="description" content="Home of Ladies Run Club in Oxted, Surrey">

	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
</head>

<body>

<header>
	<div class="container text-center">
		<div class="row m-2">
			<div class="col">
				<img class="img-fluid" src="images/logo.svg">
			</div>
		</div>
		<hr>
	</div>
</header>

<main>
	<div class="container">

		<div class="row justify-content-center">

			<form id="enquiry-form">

				<div class="row mb-4 lead text-center">
					Be notified of upcoming running sessions and courses by registering your email address with us
				</div>

				<div class="form-group row">

					<div class="col-6">
						<input type="text" class="form-control" name="firstName" autocomplete="home firstName" placeholder="First name" required>
					</div>

					<div class="col-6">
						<input type="text" class="form-control" name="lastName" autocomplete="home lastName" placeholder="Last name" required>
					</div>

				</div>

				<div class="form-group row">

					<div class="col">
						<div class="form-group">
							<div class="input-group">
								<span class="input-group-addon"><i class="fa fa-fw fa-envelope"></i></span>
								<input type="email" id="email" name="email" autocomplete="home email" class="form-control" placeholder="me@home.com" required>
								<span class="input-group-btn">
									<button type="submit" class="btn btn-info">Notify Me <i class="fa fa-fw fa-circle-o-notch" style="-webkit-filter: blur(0)"></i></button>
								</span>
							</div>
						</div>
					</div>

				</div>

			</form>

		</div>

		<div class="row justify-content-center">
			<div id="form-errors" class="alert alert-danger d-none" role="alert">
				<ul class="list-unstyled mb-0"></ul>
			</div>

			<div id="form-success" class="card border-0 text-center d-none" role="alert">
				<div class="card-body">
					<h4><i class="text-success align-middle fa fa-fw fa-2x fa-check-circle"></i> Thanks for registering your interest!</h4>
					<small class="text-muted">Confirmation has been sent to: <span id="confirm-email" class="text-info"></span><br/>
						(Please check your junk mail)
					</small>
				</div>
			</div>
		</div>

		<div class="row h1 justify-content-center">
			<a href="https://www.facebook.com/OxtedLadiesJoggers/"><i class="fa fa-facebook-official"></i></a>
		</div>
	</div>
</main>

<footer style="font-size: .75em" class="mt-3">
	<div class="container-fluid bg-light text-secondary">
		<div class="row pt-3 text-center">
			<div class="col-12 col-sm-4">
				Caterham
				<ul class="list-unstyled">
					<li><a href="http://www.caterhamladiesjoggers.co.uk">Caterham Ladies Joggers</a></li>
				</ul>
			</div>
			<div class="col-12 col-sm-4">
				Horsham
				<ul class="list-unstyled">
					<li><a href="http://www.horshamladiesjoggers.co.uk">Horsham Ladies Joggers</a></li>
				</ul>
			</div>
			<div class="col-12 col-sm-4">
				Reigate
				<ul class="list-unstyled">
					<li><a href="http://www.reigateladiesjoggers.co.uk">Reigate Ladies Joggers</a></li>
					<li><a href="http://www.reigatemensjoggers.co.uk">Reigate Mens Joggers</a></li>
					<li><a href="http://www.reigatejuniorjoggers.co.uk">Reigate Junior Joggers</a></li>
				</ul>
			</div>
		</div>
	</div>
</footer>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
<script src="https://use.fontawesome.com/71d7206d11.js"></script>

</body>

<script>
	const $enquiryForm = $('#enquiry-form');
	const $formSuccess = $('#form-success');
	const $formErrors = $('#form-errors');
	const $confirmEmail = $('#confirm-email');

	$enquiryForm.submit(function (event) {

		// Stop form from submitting normally
		event.preventDefault();

		startProgress();

		const email = $enquiryForm.find("input[name='email']").val();

		$enquiryForm.toggleClass('d-none', false);
		$formSuccess.toggleClass('d-none', true);
		$formErrors.toggleClass('d-none', true);

		$.post("http://server.v-home.co.uk/clubbed-svc-enquiry-handler/v1/enquiries/club-enquiry/emails/" + email, $enquiryForm.serialize())
			.done(function (response) {
				console.log(response);
				setSuccessState(email);
			})
			.fail(function (jqxhr, textStatus, error) {
				if (jqxhr.responseJSON === undefined) {
					console.error(textStatus);
					console.error(error);
				}
				else {
					setErrorState(jqxhr.responseJSON);
				}
			})
			.always(function () {
				stopProgress();
			});
	});

	function startProgress() {
		$("button[type='submit']").toggleClass('disabled', true).prop('disabled', true);
		$('.fa-circle-o-notch').toggleClass('fa-spin', true);

		$('input').toggleClass('is-invalid', false);
	}

	function stopProgress() {
		$("button[type='submit']").toggleClass('disabled', false).prop('disabled', false);
		$('.fa-circle-o-notch').toggleClass('fa-spin', false);
	}

	function setErrorState(response) {
		console.error(response);

		$enquiryForm.toggleClass('d-none', false);
		$formSuccess.toggleClass('d-none', true);
		$formErrors.toggleClass('d-none', false);

		const list = $formErrors.find('ul');
		list.empty();

		const items = response.map(function (element) {
			return '<li>' + element.errorMessage + '</li>';
		});

		list.append(items);

		response.forEach(function (element) {
			const input = $("input[name='" + element.fieldName + "']");
			input.toggleClass('is-invalid', true);
		})
	}

	function setSuccessState(email) {
		$enquiryForm.toggleClass('d-none', true);
		$formSuccess.toggleClass('d-none', false);
		$confirmEmail.text(email);
	}

</script>

</html>